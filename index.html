<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Enhanced PMC Prioritization Tool with Intelligence Integration for Strategic Outreach">
    <meta name="author" content="Renters Insurance Business Development">
    <title>Enhanced PMC Prioritization Tool - Intelligence Edition</title>
    
    <!-- Excel Export Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        /* Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }
        
        /* Stats Bar */
        .stats-bar {
            background: #f8f9fa;
            padding: 20px 40px;
            display: flex;
            justify-content: space-around;
            border-bottom: 2px solid #e9ecef;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .stat {
            text-align: center;
            min-width: 120px;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        /* Controls */
        .controls {
            padding: 30px 40px;
            background: #f8f9fa;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-group {
            flex: 1;
            min-width: 200px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #495057;
            font-weight: 500;
        }
        
        .control-group select,
        .control-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
            background: white;
        }
        
        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        /* Buttons */
        .btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            white-space: nowrap;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }
        
        /* Table */
        .table-container {
            padding: 0 40px 40px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 10;
            white-space: nowrap;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        /* Tier Styling */
        .tier-1 {
            background: linear-gradient(90deg, #d4edda 0%, transparent 100%);
        }
        
        .tier-2 {
            background: linear-gradient(90deg, #fff3cd 0%, transparent 100%);
        }
        
        .tier-3 {
            background: linear-gradient(90deg, #f8d7da 0%, transparent 100%);
        }
        
        .tier-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .tier-1 .tier-badge {
            background: #28a745;
            color: white;
        }
        
        .tier-2 .tier-badge {
            background: #ffc107;
            color: #212529;
        }
        
        .tier-3 .tier-badge {
            background: #dc3545;
            color: white;
        }
        
        /* Score Bar */
        .score-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .score-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }
        
        /* Intelligence Badges */
        .data-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .data-full {
            background: #28a745;
            color: white;
        }
        
        .data-basic {
            background: #6c757d;
            color: white;
        }
        
        .intel-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            text-align: center;
            line-height: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 5px;
        }
        
        .intel-full {
            background: #28a745;
            color: white;
        }
        
        .intel-basic {
            background: #e9ecef;
            color: #6c757d;
        }
        
        /* Program Status */
        .program-status {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 500;
            display: inline-block;
        }
        
        .status-none {
            background: #d4edda;
            color: #155724;
        }
        
        .status-weak {
            background: #cce5ff;
            color: #004085;
        }
        
        .status-competitor {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* Legend */
        .legend {
            padding: 20px 40px;
            background: #f8f9fa;
            border-top: 2px solid #e9ecef;
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Export Section */
        .export-section {
            padding: 20px 40px;
            background: white;
            border-top: 1px solid #e9ecef;
            text-align: center;
        }
        
        /* Info Box */
        .info-box {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 40px;
        }
        
        .info-box h3 {
            margin-bottom: 10px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .stats-bar {
                flex-direction: column;
                gap: 15px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .control-group {
                width: 100%;
            }
            
            .table-container {
                padding: 0 20px 20px;
            }
            
            th, td {
                padding: 8px;
                font-size: 0.9em;
            }
            
            .legend {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        /* Print Styles */
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .controls,
            .export-section {
                display: none;
            }
            
            .container {
                box-shadow: none;
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ðŸŽ¯ Enhanced PMC Prioritization Tool</h1>
            <p>Intelligence-Driven Outreach Strategy with Research Integration</p>
        </div>
        
        <!-- Statistics Bar -->
        <div class="stats-bar">
            <div class="stat">
                <div class="stat-value" id="totalCompanies">84</div>
                <div class="stat-label">Total Companies</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="tier1Count">0</div>
                <div class="stat-label">Tier 1 (Immediate)</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="tier2Count">0</div>
                <div class="stat-label">Tier 2 (Priority)</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="withIntel">0</div>
                <div class="stat-label">With Intelligence</div>
            </div>
        </div>
        
        <!-- Info Box -->
        <div class="info-box">
            <h3>ðŸ“Š How This Tool Works</h3>
            <p>Companies with <strong>Full Intelligence</strong> (âœ“) use enhanced scoring based on actual research data including current programs, providers, and pain points. 
            Companies with <strong>Basic Data</strong> (?) use estimated scoring and should be researched before outreach. 
            Filter and sort to identify your highest-priority targets with confidence.</p>
        </div>
        
        <!-- Controls -->
        <div class="controls">
            <div class="control-group">
                <label for="filterTier">Filter by Tier:</label>
                <select id="filterTier">
                    <option value="all">All Tiers</option>
                    <option value="1">Tier 1 Only (75+ points)</option>
                    <option value="2">Tier 2 Only (60-74 points)</option>
                    <option value="3">Tier 3 Only (&lt;60 points)</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="filterIntel">Filter by Intelligence:</label>
                <select id="filterIntel">
                    <option value="all">All Companies</option>
                    <option value="full">With Full Intelligence</option>
                    <option value="basic">Basic Data Only</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="searchCompany">Search Company:</label>
                <input type="text" id="searchCompany" placeholder="Type to search...">
            </div>
            
            <button class="btn" onclick="recalculateScores()">Recalculate Scores</button>
            <button class="btn btn-secondary" onclick="exportToExcel()">Export to Excel</button>
        </div>
        
        <!-- Table -->
        <div class="table-container">
            <table id="companyTable">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Company</th>
                        <th>Units</th>
                        <th>Score</th>
                        <th>Tier</th>
                        <th>Intel Status</th>
                        <th>Current Program</th>
                        <th>Opportunity</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Rows will be generated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <!-- Legend -->
        <div class="legend">
            <div class="legend-item">
                <span class="intel-icon intel-full">âœ“</span>
                <span>Full Intelligence Available</span>
            </div>
            <div class="legend-item">
                <span class="intel-icon intel-basic">?</span>
                <span>Basic Data Only</span>
            </div>
            <div class="legend-item">
                <span class="program-status status-none">No Program</span>
                <span>Greenfield Opportunity</span>
            </div>
            <div class="legend-item">
                <span class="program-status status-weak">Weak Program</span>
                <span>Enhancement Opportunity</span>
            </div>
            <div class="legend-item">
                <span class="program-status status-competitor">Competitor</span>
                <span>Displacement Opportunity</span>
            </div>
        </div>
        
        <!-- Export Section -->
        <div class="export-section">
            <p>Use filters to refine your target list, then export for CRM integration</p>
            <p style="margin-top: 10px; font-size: 0.9em; color: #6c757d;">
                Data current as of November 2024 | Created for Renters Insurance Business Development
            </p>
        </div>
    </div>
    
    <script>
        // Complete company data with intelligence indicators
        const companies = [
            { name: "GoldOller Real Estate Investments", units: 48134, hasIntel: false },
            { name: "GID / Windsor Communities", units: 48071, hasIntel: false },
            { name: "Balfour Beatty Communities", units: 47485, hasIntel: false },
            { name: "Pegasus Residential", units: 46264, hasIntel: false },
            { name: "Drucker + Falk", units: 43294, hasIntel: false },
            { name: "Dominium", units: 43199, hasIntel: false },
            { name: "Trinity Property Consultants", units: 42706, hasIntel: false },
            { name: "Elmington", units: 38953, hasIntel: false },
            { name: "Fairfield Residential", units: 38790, hasIntel: false },
            { name: "Berkshire Residential Investments", units: 38703, hasIntel: false },
            { name: "United Apartment Group*", units: 37521, hasIntel: false },
            { name: "Mission Rock Residential", units: 37236, hasIntel: false },
            { name: "Franklin Group", units: 36630, hasIntel: false },
            { name: "Westdale Real Estate Investment & Management", units: 36313, hasIntel: true, program: "none", provider: null },
            { name: "Valiant Residential*", units: 35724, hasIntel: true, program: "optional", provider: "Unknown (engaging London)" },
            { name: "Beztak", units: 34958, hasIntel: true, program: "mandatory", provider: "Popic & Habitat" },
            { name: "Knightvest Capital", units: 34697, hasIntel: true, program: "none", provider: null },
            { name: "Lindsey Management Co, Inc", units: 33668, hasIntel: true, program: "none", provider: null },
            { name: "AIR Communities", units: 33410, hasIntel: true, program: "transition", provider: "Unknown (Blackstone acquisition)" },
            { name: "Weidner Apartments Homes", units: 32244, hasIntel: true, program: "mandatory", provider: "Tenant choice" },
            { name: "IRT Living", units: 31636, hasIntel: true, program: "mandatory", provider: "Tenant choice" },
            { name: "Waterton", units: 31593, hasIntel: true, program: "unknown", provider: null },
            { name: "CWS Capital Partners", units: 30171, hasIntel: true, program: "mandatory", provider: "RealPage" },
            { name: "Allied Orion", units: 30000, hasIntel: true, program: "limited", provider: "Unknown" },
            { name: "American Landmark Apartments", units: 29144, hasIntel: true, program: "mandatory", provider: "Multiple" },
            { name: "S.L. Nusbaum Realty Co.", units: 29105, hasIntel: true, program: "unknown", provider: "S.L. Nusbaum Insurance" },
            { name: "Gables Residential", units: 28025, hasIntel: true, program: "optional", provider: null },
            { name: "Fogelman Properties", units: 28022, hasIntel: true, program: "none", provider: null },
            { name: "Kairoi Residential", units: 27777, hasIntel: true, program: "none", provider: null },
            { name: "Two Coast Living", units: 27770, hasIntel: true, program: "none", provider: null },
            { name: "Northland", units: 27692, hasIntel: true, program: "mandatory", provider: "Unknown" },
            { name: "Mill Creek Residential", units: 27279, hasIntel: true, program: "mandatory", provider: "Tenant choice" },
            { name: "Bryten Real Estate Partners", units: 27017, hasIntel: true, program: "likely", provider: "LFT/Markel (CA/TX only)" },
            { name: "Arlington Properties", units: 26800, hasIntel: true, program: "none", provider: null },
            { name: "The Inland Real Estate Group of Cos. Inc.", units: 26276, hasIntel: true, program: "mandatory", provider: "Assurant" },
            { name: "Sentinel Real Estate Corporation", units: 26153, hasIntel: true, program: "none", provider: null },
            { name: "Landmark Properties Inc.", units: 25749, hasIntel: true, program: "optional", provider: "Multiple" },
            { name: "Brookfield Properties", units: 25004, hasIntel: true, program: "mandatory", provider: "Lockton Affinity" },
            { name: "Southwood Realty Company", units: 24800, hasIntel: true, program: "mandatory", provider: "MRI Software" },
            { name: "S2 Residential", units: 24459, hasIntel: true, program: "none", provider: null },
            { name: "Envolve Client Services Group", units: 24009, hasIntel: true, program: "none", provider: null },
            { name: "Coastal Ridge Real Estate", units: 23557, hasIntel: true, program: "none", provider: null },
            { name: "General Services Corporation", units: 22286, hasIntel: true, program: "none", provider: null },
            { name: "Continental Properties Company", units: 21658, hasIntel: true, program: "varies", provider: "ResidentShield (partial)" },
            { name: "Garden Communities", units: 21543, hasIntel: true, program: "variable", provider: "Effective Coverage (CA)" },
            { name: "Kushner Companies", units: 20000, hasIntel: true, program: "none", provider: null },
            { name: "Timberland Partners", units: 20000, hasIntel: true, program: "unclear", provider: null },
            { name: "Weinstein Properties", units: 20000, hasIntel: true, program: "mandatory", provider: "Assurant" },
            { name: "TAM Residential", units: 19609, hasIntel: true, program: "none", provider: null },
            { name: "Case & Associates", units: 19270, hasIntel: true, program: "none", provider: null },
            { name: "Birge & Held", units: 19024, hasIntel: true, program: "problematic", provider: "Unknown" },
            { name: "Princeton Management", units: 18883, hasIntel: true, program: "unclear", provider: null },
            { name: "Blanton Turner", units: 18746, hasIntel: false },
            { name: "Steadfast Companies", units: 18589, hasIntel: false },
            { name: "First Communities", units: 18508, hasIntel: false },
            { name: "Roberts Companies", units: 18382, hasIntel: false },
            { name: "Laramar Group", units: 18334, hasIntel: false },
            { name: "CA Student Living", units: 18290, hasIntel: false },
            { name: "AION Partners LLC", units: 18109, hasIntel: false },
            { name: "Corvias", units: 18023, hasIntel: false },
            { name: "Peak Campus", units: 17935, hasIntel: false },
            { name: "EdR", units: 17787, hasIntel: false },
            { name: "Campus Crest Communities", units: 17531, hasIntel: false },
            { name: "Pierce Education Properties", units: 17482, hasIntel: false },
            { name: "The Scion Group", units: 17309, hasIntel: false },
            { name: "Preiss Company", units: 17259, hasIntel: false },
            { name: "Cardinal Group", units: 17162, hasIntel: false },
            { name: "Capstone Real Estate Investments", units: 17113, hasIntel: false },
            { name: "CA Ventures", units: 17032, hasIntel: false },
            { name: "University Partners", units: 16960, hasIntel: false },
            { name: "Core Spaces", units: 16942, hasIntel: false },
            { name: "American Campus Communities", units: 16752, hasIntel: false },
            { name: "The Dinerstein Companies", units: 16712, hasIntel: false },
            { name: "CHNM", units: 16468, hasIntel: false },
            { name: "Brookside Properties", units: 15000, hasIntel: true, program: "unknown", provider: null },
            { name: "AMC Management", units: 15000, hasIntel: false },
            { name: "Towne Properties", units: 15000, hasIntel: false },
            { name: "Grand Peaks Properties", units: 15000, hasIntel: false },
            { name: "Monument Real Estate Services", units: 15000, hasIntel: false },
            { name: "Tower 16 Capital Partners", units: 15000, hasIntel: false },
            { name: "St. John Properties", units: 15000, hasIntel: false },
            { name: "Redwood Living", units: 15000, hasIntel: false },
            { name: "Hayman Company", units: 15000, hasIntel: false },
            { name: "National Property Management Associates", units: 15000, hasIntel: false }
        ];
        
        // Scoring functions
        function calculateScore(company) {
            let score = 0;
            let breakdown = {};
            
            if (company.hasIntel) {
                // Enhanced scoring with intelligence data
                
                // Current Program Status (20 points)
                if (company.program === "none") {
                    score += 20;
                    breakdown.programStatus = 20;
                } else if (company.program === "weak" || company.program === "manual" || company.program === "problematic") {
                    score += 15;
                    breakdown.programStatus = 15;
                } else if (company.program === "optional" || company.program === "unclear" || company.program === "limited") {
                    score += 10;
                    breakdown.programStatus = 10;
                } else if (company.program === "transition" || company.program === "mixed" || company.program === "varies" || company.program === "variable") {
                    score += 8;
                    breakdown.programStatus = 8;
                } else if (company.program === "mandatory" && company.provider && company.provider.includes("Assurant")) {
                    score += 3;
                    breakdown.programStatus = 3;
                } else if (company.program === "mandatory") {
                    score += 5;
                    breakdown.programStatus = 5;
                } else {
                    score += 5;
                    breakdown.programStatus = 5;
                }
                
                // Portfolio Size (15 points)
                if (company.units >= 25000 && company.units <= 35000) {
                    score += 15;
                    breakdown.portfolioSize = 15;
                } else if (company.units >= 20000 && company.units < 25000) {
                    score += 12;
                    breakdown.portfolioSize = 12;
                } else if (company.units >= 35000 && company.units < 40000) {
                    score += 8;
                    breakdown.portfolioSize = 8;
                } else if (company.units >= 15000 && company.units < 20000) {
                    score += 8;
                    breakdown.portfolioSize = 8;
                } else if (company.units >= 40000) {
                    score += 0;
                    breakdown.portfolioSize = 0;
                }
                
                // Tech Readiness (15 points) - estimated based on program type
                if (company.program === "none" || company.program === "manual") {
                    score += 15; // High opportunity for tech improvement
                    breakdown.techReadiness = 15;
                } else if (company.program === "weak" || company.program === "problematic") {
                    score += 12;
                    breakdown.techReadiness = 12;
                } else if (company.program === "optional" || company.program === "unclear" || company.program === "limited") {
                    score += 8;
                    breakdown.techReadiness = 8;
                } else {
                    score += 5;
                    breakdown.techReadiness = 5;
                }
                
                // Opportunity Signals (15 points)
                let opportunityScore = 10; // Base score
                if (company.program === "transition") opportunityScore += 5;
                if (company.provider && company.provider.includes("Unknown")) opportunityScore += 3;
                if (company.program === "none") opportunityScore += 5;
                if (company.name === "AIR Communities") opportunityScore = 15; // Blackstone acquisition
                score += Math.min(15, opportunityScore);
                breakdown.opportunitySignals = Math.min(15, opportunityScore);
                
                // Class A Focus (15 points) - estimated
                score += 10; // Default medium score without specific data
                breakdown.classAFocus = 10;
                
                // Growth Focus (10 points) - estimated
                score += 7; // Default medium score
                breakdown.growthFocus = 7;
                
                // Decision Speed (10 points) - estimated
                score += 8; // Assume mostly private companies
                breakdown.decisionSpeed = 8;
                
            } else {
                // Basic scoring for companies without intelligence
                
                // Class A Focus (25 points) - estimated
                score += 15;
                breakdown.classAFocus = 15;
                
                // Portfolio Size (20 points)
                if (company.units >= 25000 && company.units <= 35000) {
                    score += 20;
                    breakdown.portfolioSize = 20;
                } else if (company.units >= 20000 && company.units < 25000) {
                    score += 15;
                    breakdown.portfolioSize = 15;
                } else if (company.units >= 35000 && company.units < 40000) {
                    score += 10;
                    breakdown.portfolioSize = 10;
                } else if (company.units >= 15000 && company.units < 20000) {
                    score += 10;
                    breakdown.portfolioSize = 10;
                } else if (company.units >= 40000) {
                    score += 0;
                    breakdown.portfolioSize = 0;
                }
                
                // Tech Leadership (20 points) - estimated
                score += 10;
                breakdown.techLeadership = 10;
                
                // Growth Focus (15 points) - estimated
                score += 10;
                breakdown.growthFocus = 10;
                
                // Partnership Readiness (10 points) - estimated
                score += 7;
                breakdown.partnershipReadiness = 7;
                
                // Decision Speed (10 points) - estimated
                score += 8;
                breakdown.decisionSpeed = 8;
            }
            
            company.score = score;
            company.breakdown = breakdown;
            
            // Determine tier
            if (score >= 75) {
                company.tier = 1;
            } else if (score >= 60) {
                company.tier = 2;
            } else {
                company.tier = 3;
            }
            
            return score;
        }
        
        // Calculate initial scores
        companies.forEach(company => {
            calculateScore(company);
        });
        
        // Sort by score
        companies.sort((a, b) => b.score - a.score);
        
        // Render table
        function renderTable() {
            const tbody = document.getElementById('tableBody');
            const filterTier = document.getElementById('filterTier').value;
            const filterIntel = document.getElementById('filterIntel').value;
            const searchTerm = document.getElementById('searchCompany').value.toLowerCase();
            
            tbody.innerHTML = '';
            
            let tier1Count = 0;
            let tier2Count = 0;
            let withIntelCount = 0;
            let rank = 1;
            
            companies.forEach((company, index) => {
                // Count stats
                if (company.tier === 1) tier1Count++;
                if (company.tier === 2) tier2Count++;
                if (company.hasIntel) withIntelCount++;
                
                // Apply filters
                if (filterTier !== 'all' && company.tier !== parseInt(filterTier)) return;
                if (filterIntel === 'full' && !company.hasIntel) return;
                if (filterIntel === 'basic' && company.hasIntel) return;
                if (searchTerm && !company.name.toLowerCase().includes(searchTerm)) return;
                
                const row = document.createElement('tr');
                row.className = `tier-${company.tier}`;
                
                // Determine action based on intelligence
                let action = '';
                let opportunity = '';
                let currentProgram = '';
                
                if (company.hasIntel) {
                    if (company.program === 'none') {
                        currentProgram = '<span class="program-status status-none">No Program</span>';
                        opportunity = 'Greenfield - High Priority';
                        action = 'Call immediately';
                    } else if (company.program === 'weak' || company.program === 'manual' || company.program === 'problematic') {
                        currentProgram = '<span class="program-status status-weak">Weak Program</span>';
                        opportunity = 'Clear value-add';
                        action = 'Prepare enhancement pitch';
                    } else if (company.program === 'mandatory' && company.provider) {
                        currentProgram = `<span class="program-status status-competitor">${company.provider}</span>`;
                        opportunity = 'Displacement';
                        action = 'Research pain points';
                    } else if (company.program === 'transition' || company.program === 'mixed') {
                        currentProgram = '<span class="program-status status-weak">In Transition</span>';
                        opportunity = 'Timing opportunity';
                        action = 'Move fast';
                    } else if (company.program === 'optional' || company.program === 'limited') {
                        currentProgram = '<span class="program-status status-weak">Optional/Limited</span>';
                        opportunity = 'Standardization opp';
                        action = 'Propose corporate program';
                    } else if (company.program === 'unclear' || company.program === 'unknown') {
                        currentProgram = '<span class="program-status status-weak">Unclear</span>';
                        opportunity = 'Needs assessment';
                        action = 'Discovery call';
                    } else if (company.program === 'varies' || company.program === 'variable') {
                        currentProgram = '<span class="program-status status-weak">Inconsistent</span>';
                        opportunity = 'Standardization needed';
                        action = 'Propose unified solution';
                    } else {
                        currentProgram = company.program || 'Unknown';
                        opportunity = 'Assess further';
                        action = 'Research needed';
                    }
                } else {
                    currentProgram = 'â€”';
                    opportunity = 'Unknown';
                    action = 'Research first';
                }
                
                row.innerHTML = `
                    <td>${rank++}</td>
                    <td>
                        ${company.hasIntel ? '<span class="intel-icon intel-full">âœ“</span>' : '<span class="intel-icon intel-basic">?</span>'}
                        <strong>${company.name}</strong>
                    </td>
                    <td>${company.units.toLocaleString()}</td>
                    <td>
                        <strong>${company.score}</strong>/100
                        <div class="score-bar">
                            <div class="score-fill" style="width: ${company.score}%"></div>
                        </div>
                    </td>
                    <td><span class="tier-badge">Tier ${company.tier}</span></td>
                    <td>
                        ${company.hasIntel ? '<span class="data-badge data-full">Full Intel</span>' : '<span class="data-badge data-basic">Basic Only</span>'}
                    </td>
                    <td>${currentProgram}</td>
                    <td>${opportunity}</td>
                    <td><strong>${action}</strong></td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Update stats
            document.getElementById('tier1Count').textContent = tier1Count;
            document.getElementById('tier2Count').textContent = tier2Count;
            document.getElementById('withIntel').textContent = withIntelCount;
        }
        
        // Initial render
        renderTable();
        
        // Event listeners
        document.getElementById('filterTier').addEventListener('change', renderTable);
        document.getElementById('filterIntel').addEventListener('change', renderTable);
        document.getElementById('searchCompany').addEventListener('input', renderTable);
        
        // Recalculate scores
        function recalculateScores() {
            companies.forEach(company => {
                calculateScore(company);
            });
            companies.sort((a, b) => b.score - a.score);
            renderTable();
            
            // Show notification
            const notification = document.createElement('div');
            notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 1000;';
            notification.textContent = 'Scores recalculated successfully!';
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }
        
        // Export to Excel
        function exportToExcel() {
            const exportData = companies.map((company, index) => ({
                'Rank': index + 1,
                'Company': company.name,
                'Units': company.units,
                'Score': company.score,
                'Tier': company.tier,
                'Intelligence Status': company.hasIntel ? 'Full Intelligence' : 'Basic Data',
                'Current Program': company.program || 'Unknown',
                'Current Provider': company.provider || 'None',
                'Class A Focus': company.breakdown.classAFocus || 0,
                'Portfolio Size Score': company.breakdown.portfolioSize || 0,
                'Tech Readiness Score': company.breakdown.techReadiness || company.breakdown.techLeadership || 0,
                'Growth Focus Score': company.breakdown.growthFocus || 0,
                'Partnership/Decision Score': company.breakdown.partnershipReadiness || company.breakdown.decisionSpeed || 0,
                'Program Status Score': company.breakdown.programStatus || 0,
                'Opportunity Signals': company.breakdown.opportunitySignals || 0
            }));
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "PMC Prioritization");
            
            // Add column widths
            const wscols = [
                {wch: 6},  // Rank
                {wch: 40}, // Company
                {wch: 10}, // Units
                {wch: 8},  // Score
                {wch: 6},  // Tier
                {wch: 20}, // Intelligence Status
                {wch: 15}, // Current Program
                {wch: 20}, // Current Provider
                {wch: 12}, // Class A Focus
                {wch: 15}, // Portfolio Size Score
                {wch: 15}, // Tech Readiness Score
                {wch: 15}, // Growth Focus Score
                {wch: 20}, // Partnership/Decision Score
                {wch: 15}, // Program Status Score
                {wch: 15}  // Opportunity Signals
            ];
            ws['!cols'] = wscols;
            
            XLSX.writeFile(wb, "PMC_Prioritization_Enhanced.xlsx");
            
            // Show notification
            const notification = document.createElement('div');
            notification.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #007bff; color: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 1000;';
            notification.textContent = 'Excel file downloaded successfully!';
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }
        
        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + E for export
            if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                e.preventDefault();
                exportToExcel();
            }
            // Ctrl/Cmd + R for recalculate
            if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                e.preventDefault();
                recalculateScores();
            }
            // Ctrl/Cmd + F for focus search
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                e.preventDefault();
                document.getElementById('searchCompany').focus();
            }
        });
        
        // Print styling
        window.addEventListener('beforeprint', function() {
            // Expand all rows for printing
            document.getElementById('filterTier').value = 'all';
            document.getElementById('filterIntel').value = 'all';
            renderTable();
        });
    </script>
</body>
</html>
