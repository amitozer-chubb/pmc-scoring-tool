<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mid-Market PMC Intelligence & Prioritization Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }
        
        .methodology-section {
            background: white;
            margin: 0;
            padding: 0;
            border-bottom: 3px solid #e9ecef;
        }
        
        .methodology-header {
            background: #f8f9fa;
            padding: 30px 40px;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .methodology-header h2 {
            color: #2c3e50;
            margin: 0;
            font-size: 1.6em;
        }
        
        .methodology-toggle {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.3s;
        }
        
        .methodology-toggle:hover {
            background: #764ba2;
        }
        
        .methodology-content {
            padding: 40px;
            transition: all 0.3s ease-out;
            overflow: hidden;
            max-height: 2000px;
        }
        
        .methodology-content.collapsed {
            max-height: 0;
            padding: 0 40px;
        }
        
        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .strategy-box {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }
        
        .strategy-box h3 {
            color: #495057;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .strategy-box ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .strategy-box li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            line-height: 1.6;
        }
        
        .strategy-box li:before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
        }
        
        .scoring-methodology {
            margin-top: 40px;
        }
        
        .scoring-methodology h3 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.4em;
            text-align: center;
        }
        
        .scoring-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .scoring-category h4 {
            color: #495057;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }
        
        .scoring-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .scoring-table th {
            background: #667eea;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .scoring-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9em;
        }
        
        .scoring-table tr:last-child td {
            border-bottom: none;
        }
        
        .scoring-table tr:hover {
            background: #f8f9fa;
        }
        
        .tier-explanation {
            margin-top: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .tier-explanation h4 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.3em;
        }
        
        .tier-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .tier-box {
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid;
        }
        
        .tier-1-box {
            background: rgba(40, 167, 69, 0.1);
            border-color: #28a745;
        }
        
        .tier-1-box h5 {
            color: #28a745;
            margin-top: 0;
        }
        
        .tier-2-box {
            background: rgba(255, 193, 7, 0.1);
            border-color: #ffc107;
        }
        
        .tier-2-box h5 {
            color: #f39c12;
            margin-top: 0;
        }
        
        .tier-3-box {
            background: rgba(220, 53, 69, 0.1);
            border-color: #dc3545;
        }
        
        .tier-3-box h5 {
            color: #dc3545;
            margin-top: 0;
        }
        
        .tier-box p {
            margin: 10px 0;
            font-size: 0.95em;
            color: #495057;
        }
        
        .stats-bar {
            background: #f8f9fa;
            padding: 20px 40px;
            display: flex;
            justify-content: space-around;
            border-bottom: 2px solid #e9ecef;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .chubb-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
            margin-left: 5px;
        }
        
        .chubb-gce {
            background: #FFD700;
            color: #000;
        }
        
        .chubb-major {
            background: #87CEEB;
            color: #000;
        }
        
        .controls {
            padding: 30px 40px;
            background: #f8f9fa;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-group {
            flex: 1;
            min-width: 200px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #495057;
            font-weight: 500;
        }
        
        .control-group select,
        .control-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }
        
        .table-container {
            padding: 0 40px 40px;
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th {
            background: #f8f9fa;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 10;
            font-size: 0.9em;
            white-space: nowrap;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.95em;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .expandable-row {
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .expandable-row:hover {
            background: #e8f4f8;
        }
        
        .expand-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            background: #e9ecef;
            border-radius: 4px;
            margin-right: 8px;
            font-weight: bold;
            color: #495057;
            transition: transform 0.2s;
        }
        
        .expand-icon.expanded {
            transform: rotate(90deg);
        }
        
        .details-row {
            display: none;
            background: #f8fafb;
        }
        
        .details-row.show {
            display: table-row;
        }
        
        .details-content {
            padding: 20px;
            border-left: 4px solid #667eea;
        }
        
        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .detail-section {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .detail-section h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .detail-item {
            margin: 8px 0;
            display: flex;
            align-items: flex-start;
        }
        
        .detail-label {
            font-weight: 600;
            color: #495057;
            margin-right: 8px;
            min-width: 100px;
            font-size: 0.9em;
        }
        
        .detail-value {
            color: #212529;
            flex: 1;
            font-size: 0.9em;
        }
        
        .tier-1 {
            background: linear-gradient(90deg, rgba(40, 167, 69, 0.1) 0%, transparent 100%);
        }
        
        .tier-2 {
            background: linear-gradient(90deg, rgba(255, 193, 7, 0.1) 0%, transparent 100%);
        }
        
        .tier-3 {
            background: linear-gradient(90deg, rgba(220, 53, 69, 0.1) 0%, transparent 100%);
        }
        
        .tier-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .tier-1 .tier-badge {
            background: #28a745;
            color: white;
        }
        
        .tier-2 .tier-badge {
            background: #ffc107;
            color: #212529;
        }
        
        .tier-3 .tier-badge {
            background: #dc3545;
            color: white;
        }
        
        .program-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 500;
            white-space: nowrap;
        }
        
        .program-none {
            background: #d4edda;
            color: #155724;
        }
        
        .program-weak {
            background: #cce5ff;
            color: #004085;
        }
        
        .program-strong {
            background: #f8d7da;
            color: #721c24;
        }
        
        .program-transition {
            background: #fff3cd;
            color: #856404;
        }
        
        .intel-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .intel-full {
            background: #28a745;
        }
        
        .intel-basic {
            background: #6c757d;
        }
        
        .pain-point {
            display: inline-block;
            background: #ffe5e5;
            color: #d00;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            margin: 2px;
        }
        
        .opportunity-tag {
            display: inline-block;
            background: #e5f5e5;
            color: #0a0;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            margin: 2px;
        }
        
        .provider-tag {
            display: inline-block;
            background: #e5e5ff;
            color: #00d;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            margin: 2px;
        }
        
        .action-urgent {
            color: #d00;
            font-weight: 600;
        }
        
        .action-priority {
            color: #f90;
            font-weight: 600;
        }
        
        .action-standard {
            color: #090;
            font-weight: 600;
        }
        
        .legend {
            padding: 20px 40px;
            background: #f8f9fa;
            border-top: 2px solid #e9ecef;
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tooltip {
            position: relative;
            cursor: help;
            border-bottom: 1px dotted #666;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85em;
            line-height: 1.4;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        @media (max-width: 1200px) {
            .details-grid {
                grid-template-columns: 1fr;
            }
            
            .scoring-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .methodology-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .methodology-header h2 {
                font-size: 1.2em;
            }
            
            .strategy-grid {
                grid-template-columns: 1fr;
            }
            
            .tier-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-bar {
                flex-direction: column;
                gap: 15px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .table-container {
                padding: 0 20px 20px;
            }
            
            th, td {
                padding: 8px 5px;
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Mid-Market PMC Intelligence & Prioritization Platform</h1>
            <p>Strategic Outreach Tool for Property Management Companies (15-50K Units)</p>
        </div>
        
        <div class="methodology-section">
            <div class="methodology-header">
                <h2>üìä Strategic Focus: Mid-Market Property Management Companies (15-50K Units)</h2>
                <button class="methodology-toggle" onclick="toggleMethodology()">
                    <span id="methodologyToggleText">Hide Details</span> 
                    <span id="methodologyToggleIcon">‚ñº</span>
                </button>
            </div>
            
            <div class="methodology-content" id="methodologyContent">
                <div class="strategy-grid">
                    <div class="strategy-box">
                        <h3>üéØ Why Mid-Market PMCs?</h3>
                        <ul>
                            <li><strong>Decision Speed:</strong> Faster than REITs, more sophisticated than small operators</li>
                            <li><strong>Growth Trajectory:</strong> Actively expanding through acquisitions and development</li>
                            <li><strong>Technology Adoption:</strong> Investing in resident experience and operational efficiency</li>
                            <li><strong>Relationship Value:</strong> Large enough for meaningful revenue, small enough for partnership</li>
                            <li><strong>Market Gap:</strong> Often overlooked by major insurers focused on top 20 REITs</li>
                        </ul>
                    </div>
                    
                    <div class="strategy-box">
                        <h3>üîç Intelligence Sources</h3>
                        <ul>
                            <li><strong>Full Intelligence (45 companies):</strong> Comprehensive research including current programs, providers, pain points, and transition events</li>
                            <li><strong>Basic Data (39 companies):</strong> Portfolio size and market position with estimated scoring</li>
                            <li><strong>Chubb Relationships:</strong> 6 existing commercial clients identified for warm introductions</li>
                            <li><strong>Market Research:</strong> Analysis of 80+ PMCs' insurance programs and gaps</li>
                        </ul>
                    </div>
                </div>
                
                <div class="scoring-methodology">
                    <h3>üìà Intelligent Scoring Methodology (100 Points Maximum)</h3>
                    
                    <div class="scoring-grid">
                        <div class="scoring-category">
                            <h4>Enhanced Scoring (With Full Intelligence)</h4>
                            <table class="scoring-table">
                                <tr>
                                    <th>Criteria</th>
                                    <th>Points</th>
                                    <th>Key Factors</th>
                                </tr>
                                <tr>
                                    <td><strong>Current Program Status</strong></td>
                                    <td>20</td>
                                    <td>No program (20) ‚Üí Transition (18) ‚Üí Weak (15) ‚Üí Optional (12) ‚Üí Mandatory (3-8)</td>
                                </tr>
                                <tr>
                                    <td><strong>Portfolio Size Fit</strong></td>
                                    <td>15</td>
                                    <td>25-35K units (15) ‚Üí 20-25K (12) ‚Üí 15-20K (10) ‚Üí 35-40K (8) ‚Üí 40K+ (0)</td>
                                </tr>
                                <tr>
                                    <td><strong>Opportunity Signals</strong></td>
                                    <td>15</td>
                                    <td>Acquisitions, transitions, RFPs, regulatory issues, pain points</td>
                                </tr>
                                <tr>
                                    <td><strong>Tech/Infrastructure</strong></td>
                                    <td>15</td>
                                    <td>No system (15) ‚Üí Manual processes (12) ‚Üí Basic tech (10) ‚Üí Advanced (5)</td>
                                </tr>
                                <tr>
                                    <td><strong>Chubb Relationship</strong></td>
                                    <td>10</td>
                                    <td>GCE client (10) ‚Üí Major Account (7) ‚Üí No relationship (0)</td>
                                </tr>
                                <tr>
                                    <td><strong>Market Position</strong></td>
                                    <td>10</td>
                                    <td>Premium focus, Class A properties, institutional quality</td>
                                </tr>
                                <tr>
                                    <td><strong>Growth Trajectory</strong></td>
                                    <td>10</td>
                                    <td>Expanding rapidly ‚Üí Steady growth ‚Üí Stable ‚Üí Contracting</td>
                                </tr>
                                <tr>
                                    <td><strong>Decision Speed</strong></td>
                                    <td>5</td>
                                    <td>Private ownership ‚Üí Family-owned ‚Üí REIT structure</td>
                                </tr>
                            </table>
                        </div>
                        
                        <div class="scoring-category">
                            <h4>Basic Scoring (Without Full Intelligence)</h4>
                            <table class="scoring-table">
                                <tr>
                                    <th>Criteria</th>
                                    <th>Points</th>
                                    <th>Estimation Basis</th>
                                </tr>
                                <tr>
                                    <td><strong>Portfolio Size</strong></td>
                                    <td>20</td>
                                    <td>Optimal size for partnership readiness</td>
                                </tr>
                                <tr>
                                    <td><strong>Class A Focus</strong></td>
                                    <td>15</td>
                                    <td>Estimated based on markets and brand</td>
                                </tr>
                                <tr>
                                    <td><strong>Tech Leadership</strong></td>
                                    <td>10</td>
                                    <td>Industry reputation and platform adoption</td>
                                </tr>
                                <tr>
                                    <td><strong>Growth Focus</strong></td>
                                    <td>10</td>
                                    <td>Recent acquisitions and developments</td>
                                </tr>
                                <tr>
                                    <td><strong>Chubb Relationship</strong></td>
                                    <td>10</td>
                                    <td>Known commercial relationships</td>
                                </tr>
                                <tr>
                                    <td><strong>Partnership Readiness</strong></td>
                                    <td>7</td>
                                    <td>Organizational sophistication</td>
                                </tr>
                                <tr>
                                    <td><strong>Decision Speed</strong></td>
                                    <td>8</td>
                                    <td>Ownership structure</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                    <div class="tier-explanation">
                        <h4>üèÜ Priority Tier System</h4>
                        <div class="tier-grid">
                            <div class="tier-box tier-1-box">
                                <h5>Tier 1 (75+ Points)</h5>
                                <p>Immediate outreach targets. High opportunity, ready to move, clear value proposition.</p>
                                <p><strong>Target: 10-15 companies</strong></p>
                            </div>
                            <div class="tier-box tier-2-box">
                                <h5>Tier 2 (60-74 Points)</h5>
                                <p>Priority prospects requiring relationship building or market timing.</p>
                                <p><strong>Target: 20-25 companies</strong></p>
                            </div>
                            <div class="tier-box tier-3-box">
                                <h5>Tier 3 (<60 Points)</h5>
                                <p>Longer-term opportunities needing research or market development.</p>
                                <p><strong>Target: 45+ companies</strong></p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 25px; padding: 20px; background: white; border-radius: 8px; border: 1px solid #dee2e6;">
                            <p style="text-align: center; color: #6c757d; font-size: 0.95em; margin: 0;">
                                <strong>Note:</strong> This tool combines market research, intelligence gathering, and Chubb relationship data to create a dynamic prioritization system. 
                                Scores are automatically recalculated as new intelligence becomes available. Companies with <span style="color: #28a745;">‚óè</span> have verified intelligence, 
                                while those with <span style="color: #6c757d;">‚óè</span> use estimated scoring pending research.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="stats-bar">
            <div class="stat">
                <div class="stat-value" id="totalCompanies">84</div>
                <div class="stat-label">Total PMCs</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="tier1Count">0</div>
                <div class="stat-label">Tier 1 (75+)</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="withIntel">0</div>
                <div class="stat-label">With Full Intel</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="noProgram">0</div>
                <div class="stat-label">No Program</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="chubbClients">6</div>
                <div class="stat-label">Chubb Clients</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="totalUnits">0</div>
                <div class="stat-label">Total Units</div>
            </div>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="filterTier">Filter by Tier:</label>
                <select id="filterTier">
                    <option value="all">All Tiers</option>
                    <option value="1">Tier 1 (75+)</option>
                    <option value="2">Tier 2 (60-74)</option>
                    <option value="3">Tier 3 (<60)</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="filterProgram">Filter by Program:</label>
                <select id="filterProgram">
                    <option value="all">All Programs</option>
                    <option value="none">No Program</option>
                    <option value="weak">Weak/Manual</option>
                    <option value="transition">In Transition</option>
                    <option value="competitor">Has Competitor</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="filterChubb">Chubb Relationship:</label>
                <select id="filterChubb">
                    <option value="all">All Companies</option>
                    <option value="clients">Chubb Clients Only</option>
                    <option value="gce">GCE Only</option>
                    <option value="major">Major Account Only</option>
                    <option value="none">Non-Clients</option>
                </select>
            </div>
            
            <div class="control-group">
                <label for="searchCompany">Search:</label>
                <input type="text" id="searchCompany" placeholder="Company name or provider...">
            </div>
            
            <button class="btn" onclick="exportToExcel()">Export Full Report</button>
        </div>
        
        <div class="table-container">
            <table id="companyTable">
                <thead>
                    <tr>
                        <th style="width: 40px;"></th>
                        <th style="width: 60px;">Rank</th>
                        <th style="width: 250px;">Company</th>
                        <th style="width: 80px;">Units</th>
                        <th style="width: 80px;">Score</th>
                        <th style="width: 80px;">Tier</th>
                        <th style="width: 100px;">Chubb Client</th>
                        <th style="width: 120px;">Current Status</th>
                        <th style="width: 150px;">Provider/Issues</th>
                        <th style="width: 180px;">Key Intel</th>
                        <th style="width: 120px;">Action</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Rows will be generated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <span class="intel-indicator intel-full"></span>
                <span>Full Intelligence</span>
            </div>
            <div class="legend-item">
                <span class="intel-indicator intel-basic"></span>
                <span>Basic Data</span>
            </div>
            <div class="legend-item">
                <span class="program-badge program-none">No Program</span>
                <span>Greenfield</span>
            </div>
            <div class="legend-item">
                <span class="program-badge program-weak">Weak/Manual</span>
                <span>Enhancement</span>
            </div>
            <div class="legend-item">
                <span class="program-badge program-strong">Competitor</span>
                <span>Displacement</span>
            </div>
            <div class="legend-item">
                <span class="program-badge program-transition">Transition</span>
                <span>Timing Opportunity</span>
            </div>
            <div class="legend-item">
                <span class="chubb-badge chubb-gce">GCE</span>
                <span>Global Client Executive</span>
            </div>
            <div class="legend-item">
                <span class="chubb-badge chubb-major">Major Account</span>
                <span>Chubb Client</span>
            </div>
        </div>
    </div>
    
    <script>
        // Toggle methodology section
        function toggleMethodology() {
            const content = document.getElementById('methodologyContent');
            const toggleText = document.getElementById('methodologyToggleText');
            const toggleIcon = document.getElementById('methodologyToggleIcon');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                toggleText.textContent = 'Hide Details';
                toggleIcon.textContent = '‚ñº';
            } else {
                content.classList.add('collapsed');
                toggleText.textContent = 'Show Details';
                toggleIcon.textContent = '‚ñ∂';
            }
        }
        
        // Enhanced company data with full intelligence
        const companies = [
            { 
                name: "GoldOller Real Estate Investments", 
                units: 48134, 
                hasIntel: false 
            },
            { 
                name: "GID / Windsor Communities", 
                units: 48071, 
                hasIntel: false 
            },
            { 
                name: "Balfour Beatty Communities", 
                units: 47485, 
                hasIntel: false 
            },
            { 
                name: "Pegasus Residential", 
                units: 46264, 
                hasIntel: false 
            },
            { 
                name: "Drucker + Falk", 
                units: 43294, 
                hasIntel: false 
            },
            { 
                name: "Dominium", 
                units: 43199, 
                hasIntel: false 
            },
            { 
                name: "Trinity Property Consultants", 
                units: 42706, 
                hasIntel: false 
            },
            { 
                name: "Elmington", 
                units: 38953, 
                hasIntel: false 
            },
            { 
                name: "Fairfield Residential", 
                units: 38790, 
                hasIntel: false 
            },
            { 
                name: "Berkshire Residential Investments", 
                units: 38703, 
                hasIntel: false 
            },
            { 
                name: "United Apartment Group*", 
                units: 37521, 
                hasIntel: false 
            },
            { 
                name: "Mission Rock Residential", 
                units: 37236, 
                hasIntel: false 
            },
            { 
                name: "Franklin Group", 
                units: 36630, 
                hasIntel: false 
            },
            { 
                name: "Westdale Real Estate Investment & Management", 
                units: 36313, 
                hasIntel: true,
                program: "none",
                provider: null,
                intelligence: {
                    status: "No current program",
                    opportunities: ["Greenfield opportunity", "40,000+ units unprotected"],
                    painPoints: [],
                    details: "No renters insurance requirements found across portfolio",
                    recommendation: "Immediate high-value target"
                }
            },
            { 
                name: "Valiant Residential*", 
                units: 35724, 
                hasIntel: true,
                program: "developing",
                provider: "Engaging London underwriters",
                intelligence: {
                    status: "Actively developing program",
                    opportunities: ["Currently shopping for provider", "Executive engagement"],
                    painPoints: ["Looking for exclusive national program"],
                    details: "Executives actively engaging with London underwriters for optional national program",
                    recommendation: "Move fast - active RFP"
                }
            },
            { 
                name: "Beztak", 
                units: 34958, 
                hasIntel: true,
                program: "mandatory",
                provider: "Popic & Habitat Specialty",
                intelligence: {
                    status: "Auto-enrollment program",
                    opportunities: ["95%+ participation rate model"],
                    painPoints: ["$19/month damage waiver"],
                    details: "Auto-enrollment with opt-out, Confirm Insurance + Inzu partnership",
                    recommendation: "Study displacement angle"
                }
            },
            { 
                name: "Knightvest Capital", 
                units: 34697, 
                hasIntel: true,
                program: "none",
                provider: null,
                intelligence: {
                    status: "No program",
                    opportunities: ["55,000+ units opportunity", "No requirements"],
                    painPoints: [],
                    details: "No renters insurance requirements found",
                    recommendation: "High-priority greenfield"
                }
            },
            { 
                name: "Lindsey Management Co, Inc", 
                units: 33668, 
                hasIntel: true,
                program: "none",
                provider: null,
                intelligence: {
                    status: "No program",
                    opportunities: ["40,000+ units", "Regional concentration"],
                    painPoints: [],
                    details: "No requirements across portfolio",
                    recommendation: "Regional approach opportunity"
                }
            },
            { 
                name: "AIR Communities", 
                units: 33410, 
                hasIntel: true,
                program: "transition",
                provider: "Unknown",
                chubbStatus: "Major",
                intelligence: {
                    status: "Post-acquisition transition",
                    opportunities: ["$10B Blackstone acquisition 2024", "Vendor review period", "Existing Chubb relationship"],
                    painPoints: ["Recent restructuring", "Integration challenges"],
                    details: "Recently acquired by Blackstone, likely reviewing all vendor relationships. Major Account client of Chubb.",
                    recommendation: "Perfect timing + warm intro - move now"
                }
            },
            { 
                name: "Weidner Apartments Homes", 
                units: 32244, 
                hasIntel: true,
                program: "mandatory",
                provider: "Tenant choice",
                intelligence: {
                    status: "Mandatory but no provider",
                    opportunities: ["No exclusive partnership", "Tenant confusion"],
                    painPoints: ["Compliance tracking issues"],
                    details: "Requires insurance but tenants must source independently",
                    recommendation: "Value-add partnership opportunity"
                }
            },
            { 
                name: "IRT Living", 
                units: 31636, 
                hasIntel: true,
                program: "mandatory",
                provider: "Tenant choice",
                chubbStatus: "Major",
                intelligence: {
                    status: "Mandatory, tenant-sourced",
                    opportunities: ["$100K liability requirement", "38,000+ units", "Chubb Major Account client"],
                    painPoints: ["Manual verification", "No support system"],
                    details: "Independence Realty Trust - requires proof but manual process. Existing Chubb Major Account relationship.",
                    recommendation: "Leverage Chubb relationship for warm intro"
                }
            },
            { 
                name: "Waterton", 
                units: 31593, 
                hasIntel: true,
                program: "unknown",
                provider: null,
                intelligence: {
                    status: "Program unclear",
                    opportunities: ["Large portfolio", "Needs assessment"],
                    painPoints: [],
                    details: "Unable to confirm requirements",
                    recommendation: "Research needed"
                }
            },
            { 
                name: "CWS Capital Partners", 
                units: 30171, 
                hasIntel: true,
                program: "mandatory",
                provider: "RealPage RenterProtection",
                intelligence: {
                    status: "Dual program structure",
                    opportunities: ["Complex structure creates gaps"],
                    painPoints: ["Supplemental coverage costs", "Double payment"],
                    details: "Required insurance PLUS RenterProtection for gaps",
                    recommendation: "Simplification pitch"
                }
            },
            { 
                name: "Allied Orion", 
                units: 30000, 
                hasIntel: true,
                program: "limited",
                provider: "Unknown",
                intelligence: {
                    status: "Property-specific only",
                    opportunities: ["Infrastructure exists", "Needs expansion"],
                    painPoints: ["Inconsistent coverage"],
                    details: "Portal mentions insurance but limited implementation",
                    recommendation: "Expansion opportunity"
                }
            },
            { 
                name: "American Landmark Apartments", 
                units: 29144, 
                hasIntel: true,
                program: "mandatory",
                provider: "Multiple providers",
                intelligence: {
                    status: "Mandatory with tracking",
                    opportunities: ["Automated tracking system"],
                    painPoints: ["Non-compliance fees", "Multiple vendors"],
                    details: "Mandatory for all tenants with automated tracking",
                    recommendation: "Consolidation opportunity"
                }
            },
            { 
                name: "S.L. Nusbaum Realty Co.", 
                units: 29105, 
                hasIntel: true,
                program: "agency",
                provider: "S.L. Nusbaum Insurance (Travelers)",
                intelligence: {
                    status: "Has insurance agency",
                    opportunities: ["Internal agency partnership"],
                    painPoints: ["No clear mandatory requirements"],
                    details: "Own insurance agency with Travelers partnership",
                    recommendation: "Partner with agency"
                }
            },
            { 
                name: "Gables Residential", 
                units: 28025, 
                hasIntel: true,
                program: "optional",
                provider: null,
                intelligence: {
                    status: "No clear program",
                    opportunities: ["28,000+ units", "No corporate program"],
                    painPoints: [],
                    details: "No clear corporate-level program",
                    recommendation: "Corporate standardization"
                }
            },
            { 
                name: "Fogelman Properties", 
                units: 28022, 
                hasIntel: true,
                program: "none",
                provider: null,
                intelligence: {
                    status: "No program",
                    opportunities: ["28,000+ units greenfield"],
                    painPoints: [],
                    details: "No requirements found",
                    recommendation: "Greenfield opportunity"
                }
            },
            { 
                name: "Kairoi Residential", 
                units: 27777, 
                hasIntel: true,
                program: "none",
                provider: null,
                intelligence: {
                    status: "No program",
                    opportunities: ["27,000+ units available"],
                    painPoints: [],
                    details: "No current program identified",
                    recommendation: "Greenfield target"
                }
            },
            { 
                name: "Two Coast Living", 
                units: 27770, 
                hasIntel: true,
                program: "none",
                provider: null,
                intelligence: {
                    status: "No program",
                    opportunities: ["Bi-coastal portfolio"],
                    painPoints: [],
                    details: "No requirements found",
                    recommendation: "Geographic play"
                }
            },
            { 
                name: "Northland", 
                units: 27692, 
                hasIntel: true,
                program: "mandatory",
                provider: "Unknown carrier",
                intelligence: {
                    status: "Proof required",
                    opportunities: ["Carrier unknown"],
                    painPoints: ["Unclear provider relationship"],
                    details: "Proof of insurance coverage required",
                    recommendation: "Research current provider"
                }
            },
            { 
                name: "Mill Creek Residential", 
                units: 27279, 
                hasIntel: true,
                program: "mandatory",
                provider: "Tenant choice",
                intelligence: {
                    status: "No exclusive provider",
                    opportunities: ["275,000+ units developed", "No partnership"],
                    painPoints: ["Provider fragmentation"],
                    details: "Requires insurance with provider of choice",
                    recommendation: "Exclusive partnership pitch"
                }
            },
            { 
                name: "Bryten Real Estate Partners", 
                units: 27017, 
                hasIntel: true,
                program: "partial",
                provider: "LFT/Markel (CA/TX only)",
                intelligence: {
                    status: "Limited geographic coverage",
                    opportunities: ["Coverage gaps outside CA/TX"],
                    painPoints: ["Incomplete portfolio coverage"],
                    details: "Partnership evidence in CA/TX only through LFT Insurance",
                    recommendation: "National expansion"
                }
            },
            { 
                name: "Arlington Properties", 
                units: 26800, 
                hasIntel: true,
                program: "none",
                provider: null,
                intelligence: {
                    status: "No program",
                    opportunities: ["26,800 units available"],
                    painPoints: [],
                    details: "No requirements found",
                    recommendation: "Greenfield opportunity"
                }
            },
            { 
                name: "The Inland Real Estate Group of Cos. Inc.", 
                units: 26276, 
                hasIntel: true,
                program: "mandatory",
                provider: "Assurant (Cover360)",
                intelligence: {
                    status: "Assurant partnership",
                    opportunities: ["Bundled with rent option"],
                    painPoints: [],
                    details: "All leases require insurance, Cover360 program",
                    recommendation: "Competitive displacement"
                }
            },
            { 
                name: "Sentinel Real Estate Corporation", 
                units: 26153, 
                hasIntel: true,
                program: "none",
                provider: null,
                intelligence: {
                    status: "No program",
                    opportunities: ["156,000+ total units", "Massive opportunity"],
                    painPoints: [],
                    details: "No current program across large portfolio",
                    recommendation: "Tier 1 priority"
                }
            },
            { 
                name: "Landmark Properties Inc.", 
                units: 25749, 
                hasIntel: true,
                program: "optional",
                provider: "Multiple options",
                intelligence: {
                    status: "Optional/Recommended",
                    opportunities: ["Student housing focus"],
                    painPoints: ["Location-specific requirements"],
                    details: "Tenant portals allow proof submission/purchase",
                    recommendation: "Standardization opportunity"
                }
            },
            { 
                name: "Brookfield Properties", 
                units: 25004, 
                hasIntel: true,
                program: "mixed",
                provider: "Lockton Affinity/Liberty Mutual",
                chubbStatus: "GCE",
                intelligence: {
                    status: "Commercial focus",
                    opportunities: ["80+ communities", "Residential gap", "GCE relationship - highest level"],
                    painPoints: ["Retail program only", "No residential"],
                    details: "Strong commercial program but limited residential. BROOKFIELD CORPORATION is a Chubb GCE client.",
                    recommendation: "Executive-level approach via GCE"
                }
            },
            { 
                name: "Southwood Realty Company", 
                units: 24800, 
                hasIntel: true,
                program: "mandatory",
                provider: "MRI Multifamily Insurance",
                intelligence: {
                    status: "Recently implemented",
                    opportunities: ["95% compliance rate"],
                    painPoints: ["Recent implementation"],
                    details: "Fully managed program with auto-enrollment",
                    recommendation: "Monitor for issues"
                }
            },
            { 
                name: "S2 Residential", 
                units: 24459, 
                hasIntel: true,
                program: "none",
                provider: null,
                intelligence: {
                    status: "No program",
                    opportunities: ["24,000+ units"],
                    painPoints: [],
                    details: "No current program",
                    recommendation: "Greenfield"
                }
            },
            { 
                name: "Envolve Client Services Group", 
                units: 24009, 
                hasIntel: true,
                program: "none",
                provider: null,
                intelligence: {
                    status: "No program",
                    opportunities: ["24,000 units available"],
                    painPoints: [],
                    details: "No requirements found",
                    recommendation: "Greenfield opportunity"
                }
            },
            { 
                name: "Coastal Ridge Real Estate", 
                units: 23557, 
                hasIntel: true,
                program: "none",
                provider: null,
                intelligence: {
                    status: "No program",
                    opportunities: ["Coastal markets"],
                    painPoints: [],
                    details: "No current program",
                    recommendation: "Regional approach"
                }
            },
            { 
                name: "General Services Corporation", 
                units: 22286, 
                hasIntel: true,
                program: "none",
                provider: null,
                intelligence: {
                    status: "No program",
                    opportunities: ["22,000+ units"],
                    painPoints: [],
                    details: "No requirements found",
                    recommendation: "Greenfield"
                }
            },
            { 
                name: "Continental Properties Company", 
                units: 21658, 
                hasIntel: true,
                program: "varies",
                provider: "ResidentShield (Pacific only)",
                intelligence: {
                    status: "Inconsistent by brand",
                    opportunities: ["Standardization needed"],
                    painPoints: ["Brand inconsistency"],
                    details: "HO4 or master policy varies by brand",
                    recommendation: "Corporate standardization"
                }
            },
            { 
                name: "Garden Communities", 
                units: 21543, 
                hasIntel: true,
                program: "variable",
                provider: "Effective Coverage (CA)",
                intelligence: {
                    status: "Market-specific only",
                    opportunities: ["Gaps outside California"],
                    painPoints: ["$300K liability in CA only"],
                    details: "Requirements vary significantly by location",
                    recommendation: "National program"
                }
            },
            { 
                name: "Kushner Companies", 
                units: 20000, 
                hasIntel: true,
                program: "none",
                provider: null,
                intelligence: {
                    status: "No program",
                    opportunities: ["High-profile ownership"],
                    painPoints: [],
                    details: "No current program",
                    recommendation: "Executive approach"
                }
            },
            { 
                name: "Timberland Partners", 
                units: 20000, 
                hasIntel: true,
                program: "unclear",
                provider: null,
                intelligence: {
                    status: "Requirements unclear",
                    opportunities: ["Has insurance role posted"],
                    painPoints: ["Unable to confirm program"],
                    details: "Insurance infrastructure but unclear requirements",
                    recommendation: "Needs investigation"
                }
            },
            { 
                name: "Weinstein Properties", 
                units: 20000, 
                hasIntel: true,
                program: "mandatory",
                provider: "Assurant",
                chubbStatus: "Major",
                intelligence: {
                    status: "Existing Assurant partnership",
                    opportunities: ["Family-owned 70+ years", "Chubb Major Account client"],
                    painPoints: ["Service issues potential"],
                    details: "Confirmed Assurant partnership. Existing Chubb Major Account relationship.",
                    recommendation: "Leverage relationship for displacement"
                }
            },
            { 
                name: "TAM Residential", 
                units: 19609, 
                hasIntel: true,
                program: "none",
                provider: null,
                intelligence: {
                    status: "No program",
                    opportunities: ["19,000+ units"],
                    painPoints: [],
                    details: "No current program",
                    recommendation: "Greenfield"
                }
            },
            { 
                name: "Case & Associates", 
                units: 19270, 
                hasIntel: true,
                program: "none",
                provider: null,
                intelligence: {
                    status: "No program",
                    opportunities: ["30,000+ units claimed"],
                    painPoints: [],
                    details: "No requirements found",
                    recommendation: "High-value greenfield"
                }
            },
            { 
                name: "Birge & Held", 
                units: 19024, 
                hasIntel: true,
                program: "problematic",
                provider: "Unknown (fee-based)",
                intelligence: {
                    status: "Problematic fee structure",
                    opportunities: ["Poor communication"],
                    painPoints: ["Building & Facilities fee unclear", "BBB complaints"],
                    details: "Unclear coverage with poorly communicated fees",
                    recommendation: "Transparency value prop"
                }
            },
            { 
                name: "Princeton Management", 
                units: 18883, 
                hasIntel: true,
                program: "unclear",
                provider: null,
                intelligence: {
                    status: "Requirements unknown",
                    opportunities: ["Needs assessment"],
                    painPoints: [],
                    details: "Unable to confirm requirements",
                    recommendation: "Research needed"
                }
            },
            { 
                name: "Blanton Turner", 
                units: 18746, 
                hasIntel: false 
            },
            { 
                name: "Steadfast Companies", 
                units: 18589, 
                hasIntel: false 
            },
            { 
                name: "First Communities", 
                units: 18508, 
                hasIntel: false 
            },
            { 
                name: "Roberts Companies", 
                units: 18382, 
                hasIntel: false 
            },
            { 
                name: "Laramar Group", 
                units: 18334, 
                hasIntel: false 
            },
            { 
                name: "CA Student Living", 
                units: 18290, 
                hasIntel: false 
            },
            { 
                name: "AION Partners LLC", 
                units: 18109, 
                hasIntel: false 
            },
            { 
                name: "Corvias", 
                units: 18023, 
                hasIntel: false 
            },
            { 
                name: "Peak Campus", 
                units: 17935, 
                hasIntel: false 
            },
            { 
                name: "EdR", 
                units: 17787, 
                hasIntel: false 
            },
            { 
                name: "Campus Crest Communities", 
                units: 17531, 
                hasIntel: false 
            },
            { 
                name: "Pierce Education Properties", 
                units: 17482, 
                hasIntel: false 
            },
            { 
                name: "The Scion Group", 
                units: 17309, 
                hasIntel: false 
            },
            { 
                name: "Preiss Company", 
                units: 17259, 
                hasIntel: false 
            },
            { 
                name: "Cardinal Group", 
                units: 17162, 
                hasIntel: false 
            },
            { 
                name: "Capstone Real Estate Investments", 
                units: 17113, 
                hasIntel: false 
            },
            { 
                name: "CA Ventures", 
                units: 17032, 
                hasIntel: false 
            },
            { 
                name: "University Partners", 
                units: 16960, 
                hasIntel: false 
            },
            { 
                name: "Core Spaces", 
                units: 16942, 
                hasIntel: false 
            },
            { 
                name: "American Campus Communities", 
                units: 16752, 
                hasIntel: false 
            },
            { 
                name: "The Dinerstein Companies", 
                units: 16712, 
                hasIntel: false 
            },
            { 
                name: "CHNM", 
                units: 16468, 
                hasIntel: false 
            },
            { 
                name: "Brookside Properties", 
                units: 15000, 
                hasIntel: true,
                program: "unknown",
                provider: null,
                chubbStatus: "Major",
                intelligence: {
                    status: "Inconsistent/Unknown",
                    opportunities: ["Needs assessment", "Chubb Major Account client"],
                    painPoints: [],
                    details: "No specific requirements found. Existing Chubb Major Account relationship.",
                    recommendation: "Use Chubb relationship for discovery"
                }
            },
            { 
                name: "AMC Management", 
                units: 15000, 
                hasIntel: false,
                chubbStatus: "Major"
            },
            { 
                name: "Towne Properties", 
                units: 15000, 
                hasIntel: false 
            },
            { 
                name: "Grand Peaks Properties", 
                units: 15000, 
                hasIntel: false 
            },
            { 
                name: "Monument Real Estate Services", 
                units: 15000, 
                hasIntel: false 
            },
            { 
                name: "Tower 16 Capital Partners", 
                units: 15000, 
                hasIntel: false 
            },
            { 
                name: "St. John Properties", 
                units: 15000, 
                hasIntel: false 
            },
            { 
                name: "Redwood Living", 
                units: 15000, 
                hasIntel: false 
            },
            { 
                name: "Hayman Company", 
                units: 15000, 
                hasIntel: false 
            },
            { 
                name: "National Property Management Associates", 
                units: 15000, 
                hasIntel: false 
            }
        ];
        
        // Calculate scores
        function calculateScore(company) {
            let score = 0;
            
            if (company.hasIntel) {
                // Enhanced scoring with intelligence
                
                // Program Status (20 points)
                if (company.program === "none") {
                    score += 20;
                } else if (company.program === "developing" || company.program === "transition") {
                    score += 18;
                } else if (company.program === "weak" || company.program === "problematic" || company.program === "unclear") {
                    score += 15;
                } else if (company.program === "optional" || company.program === "partial" || company.program === "limited") {
                    score += 12;
                } else if (company.program === "varies" || company.program === "variable" || company.program === "mixed") {
                    score += 10;
                } else if (company.program === "mandatory" && !company.provider) {
                    score += 8;
                } else if (company.program === "mandatory" && company.provider && company.provider.includes("Assurant")) {
                    score += 3;
                } else if (company.program === "mandatory") {
                    score += 5;
                } else {
                    score += 7;
                }
                
                // Portfolio Size (15 points)
                if (company.units >= 25000 && company.units <= 35000) {
                    score += 15;
                } else if (company.units >= 20000 && company.units < 25000) {
                    score += 12;
                } else if (company.units >= 35000 && company.units < 40000) {
                    score += 8;
                } else if (company.units >= 15000 && company.units < 20000) {
                    score += 10;
                } else if (company.units >= 40000) {
                    score += 0;
                }
                
                // Opportunity Signals (15 points)
                let oppScore = 8;
                if (company.intelligence) {
                    if (company.intelligence.opportunities) {
                        if (company.intelligence.opportunities.some(o => o.includes("acquisition") || o.includes("RFP") || o.includes("shopping"))) {
                            oppScore += 7;
                        } else if (company.intelligence.opportunities.some(o => o.includes("greenfield") || o.includes("no program"))) {
                            oppScore += 5;
                        }
                    }
                    if (company.intelligence.painPoints && company.intelligence.painPoints.length > 0) {
                        oppScore += 3;
                    }
                }
                score += Math.min(15, oppScore);
                
                // Tech/Infrastructure (15 points)
                if (company.program === "none" || company.program === "problematic") {
                    score += 15;
                } else if (company.provider === "Tenant choice" || company.provider === "Unknown") {
                    score += 12;
                } else if (company.program === "manual" || (company.intelligence && company.intelligence.details && company.intelligence.details.includes("manual"))) {
                    score += 10;
                } else {
                    score += 5;
                }
                
                // Chubb Relationship (10 points)
                if (company.chubbStatus === "GCE") {
                    score += 10;
                } else if (company.chubbStatus === "Major") {
                    score += 7;
                }
                
                // Market Position (10 points) - estimated
                score += 8;
                
                // Growth (10 points) - estimated
                score += 7;
                
                // Decision Speed (5 points) - estimated
                score += 5;
                
            } else {
                // Basic scoring
                score += 15; // Class A estimate
                
                // Portfolio size
                if (company.units >= 25000 && company.units <= 35000) {
                    score += 20;
                } else if (company.units >= 20000 && company.units < 25000) {
                    score += 15;
                } else if (company.units >= 35000 && company.units < 40000) {
                    score += 10;
                } else if (company.units >= 15000 && company.units < 20000) {
                    score += 10;
                } else if (company.units >= 40000) {
                    score += 0;
                }
                
                // Chubb Relationship (10 points)
                if (company.chubbStatus === "GCE") {
                    score += 10;
                } else if (company.chubbStatus === "Major") {
                    score += 7;
                }
                
                score += 10; // Tech estimate
                score += 10; // Growth estimate
                score += 7;  // Partnership readiness
                score += 8;  // Decision speed
            }
            
            company.score = score;
            
            // Assign tier
            if (score >= 75) {
                company.tier = 1;
            } else if (score >= 60) {
                company.tier = 2;
            } else {
                company.tier = 3;
            }
            
            return score;
        }
        
        // Calculate all scores
        companies.forEach(company => {
            calculateScore(company);
        });
        
        // Sort by score
        companies.sort((a, b) => b.score - a.score);
        
        // Toggle details row
        function toggleDetails(index) {
            const detailsRow = document.getElementById(`details-${index}`);
            const expandIcon = document.getElementById(`expand-${index}`);
            
            if (detailsRow.classList.contains('show')) {
                detailsRow.classList.remove('show');
                expandIcon.classList.remove('expanded');
            } else {
                detailsRow.classList.add('show');
                expandIcon.classList.add('expanded');
            }
        }
        
        // Render table
        function renderTable() {
            const tbody = document.getElementById('tableBody');
            const filterTier = document.getElementById('filterTier').value;
            const filterProgram = document.getElementById('filterProgram').value;
            const filterChubb = document.getElementById('filterChubb').value;
            const searchTerm = document.getElementById('searchCompany').value.toLowerCase();
            
            tbody.innerHTML = '';
            
            let tier1Count = 0;
            let tier2Count = 0;
            let withIntelCount = 0;
            let noProgramCount = 0;
            let chubbClientCount = 0;
            let totalUnits = 0;
            let rank = 1;
            
            companies.forEach((company, index) => {
                // Count stats
                if (company.tier === 1) tier1Count++;
                if (company.tier === 2) tier2Count++;
                if (company.hasIntel) withIntelCount++;
                if (company.program === "none") noProgramCount++;
                if (company.chubbStatus === "GCE" || company.chubbStatus === "Major") chubbClientCount++;
                totalUnits += company.units;
                
                // Apply filters
                if (filterTier !== 'all' && company.tier !== parseInt(filterTier)) return;
                
                if (filterProgram !== 'all') {
                    if (filterProgram === 'none' && company.program !== 'none') return;
                    if (filterProgram === 'weak' && !['weak', 'manual', 'problematic', 'unclear'].includes(company.program)) return;
                    if (filterProgram === 'transition' && !['transition', 'developing', 'mixed'].includes(company.program)) return;
                    if (filterProgram === 'competitor' && (!company.provider || company.provider === 'Tenant choice')) return;
                }
                
                if (filterChubb !== 'all') {
                    if (filterChubb === 'clients' && !company.chubbStatus) return;
                    if (filterChubb === 'gce' && company.chubbStatus !== 'GCE') return;
                    if (filterChubb === 'major' && company.chubbStatus !== 'Major') return;
                    if (filterChubb === 'none' && company.chubbStatus) return;
                }
                
                if (searchTerm) {
                    const searchIn = (company.name + ' ' + (company.provider || '') + ' ' + (company.intelligence?.details || '')).toLowerCase();
                    if (!searchIn.includes(searchTerm)) return;
                }
                
                // Main row
                const row = document.createElement('tr');
                row.className = `expandable-row tier-${company.tier}`;
                
                // Determine status badge
                let statusBadge = '';
                if (company.program === 'none') {
                    statusBadge = '<span class="program-badge program-none">No Program</span>';
                } else if (['weak', 'manual', 'problematic', 'unclear'].includes(company.program)) {
                    statusBadge = '<span class="program-badge program-weak">Weak/Manual</span>';
                } else if (['transition', 'developing', 'mixed'].includes(company.program)) {
                    statusBadge = '<span class="program-badge program-transition">Transition</span>';
                } else if (company.program === 'mandatory' && company.provider) {
                    statusBadge = '<span class="program-badge program-strong">Has Program</span>';
                } else if (company.hasIntel) {
                    statusBadge = `<span class="program-badge">${company.program || 'Unknown'}</span>`;
                } else {
                    statusBadge = '‚Äî';
                }
                
                // Provider/Issues column
                let providerInfo = '';
                if (company.hasIntel && company.intelligence) {
                    if (company.provider) {
                        providerInfo = `<span class="provider-tag">${company.provider}</span>`;
                    }
                    if (company.intelligence.painPoints && company.intelligence.painPoints.length > 0) {
                        company.intelligence.painPoints.forEach(point => {
                            if (point.length < 30) {
                                providerInfo += ` <span class="pain-point">${point}</span>`;
                            }
                        });
                    }
                } else {
                    providerInfo = '‚Äî';
                }
                
                // Key Intel column
                let keyIntel = '';
                if (company.hasIntel && company.intelligence) {
                    if (company.intelligence.opportunities) {
                        const topOpp = company.intelligence.opportunities[0];
                        if (topOpp && topOpp.length < 40) {
                            keyIntel = `<span class="opportunity-tag">${topOpp}</span>`;
                        }
                    }
                } else {
                    keyIntel = 'Research needed';
                }
                
                // Action column
                let action = '';
                if (company.hasIntel && company.intelligence) {
                    const rec = company.intelligence.recommendation;
                    if (rec.includes('immediate') || rec.includes('fast') || rec.includes('now')) {
                        action = `<span class="action-urgent">${rec}</span>`;
                    } else if (rec.includes('priority') || rec.includes('opportunity')) {
                        action = `<span class="action-priority">${rec}</span>`;
                    } else {
                        action = `<span class="action-standard">${rec}</span>`;
                    }
                } else {
                    action = 'Research first';
                }
                
                // Chubb Client column
                let chubbBadge = '';
                if (company.chubbStatus === 'GCE') {
                    chubbBadge = '<span class="chubb-badge chubb-gce">GCE</span>';
                } else if (company.chubbStatus === 'Major') {
                    chubbBadge = '<span class="chubb-badge chubb-major">Major Account</span>';
                } else {
                    chubbBadge = '‚Äî';
                }
                
                row.innerHTML = `
                    <td onclick="toggleDetails(${index})">
                        <span id="expand-${index}" class="expand-icon">‚Ä∫</span>
                    </td>
                    <td>${rank++}</td>
                    <td>
                        <span class="intel-indicator ${company.hasIntel ? 'intel-full' : 'intel-basic'}"></span>
                        <strong>${company.name}</strong>
                    </td>
                    <td>${company.units.toLocaleString()}</td>
                    <td><strong>${company.score}</strong></td>
                    <td><span class="tier-badge">Tier ${company.tier}</span></td>
                    <td>${chubbBadge}</td>
                    <td>${statusBadge}</td>
                    <td>${providerInfo}</td>
                    <td>${keyIntel}</td>
                    <td>${action}</td>
                `;
                
                tbody.appendChild(row);
                
                // Details row
                if (company.hasIntel && company.intelligence) {
                    const detailsRow = document.createElement('tr');
                    detailsRow.id = `details-${index}`;
                    detailsRow.className = 'details-row';
                    
                    detailsRow.innerHTML = `
                        <td colspan="10">
                            <div class="details-content">
                                <div class="details-grid">
                                    <div class="detail-section">
                                        <h4>Company Overview</h4>
                                        <div class="detail-item">
                                            <span class="detail-label">Portfolio:</span>
                                            <span class="detail-value">${company.units.toLocaleString()} units</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Current Status:</span>
                                            <span class="detail-value">${company.intelligence.status}</span>
                                        </div>
                                        <div class="detail-item">
                                            <span class="detail-label">Provider:</span>
                                            <span class="detail-value">${company.provider || 'None'}</span>
                                        </div>
                                    </div>
                                    
                                    <div class="detail-section">
                                        <h4>Opportunities</h4>
                                        ${company.intelligence.opportunities ? company.intelligence.opportunities.map(opp => 
                                            `<div class="detail-item">‚Ä¢ ${opp}</div>`
                                        ).join('') : '<div class="detail-item">No specific opportunities identified</div>'}
                                    </div>
                                    
                                    <div class="detail-section">
                                        <h4>Intelligence Details</h4>
                                        <div class="detail-item">
                                            <span class="detail-value">${company.intelligence.details}</span>
                                        </div>
                                        ${company.intelligence.painPoints && company.intelligence.painPoints.length > 0 ? 
                                            `<div class="detail-item" style="margin-top: 10px;">
                                                <span class="detail-label">Pain Points:</span>
                                                <span class="detail-value">${company.intelligence.painPoints.join(', ')}</span>
                                            </div>` : ''
                                        }
                                    </div>
                                    
                                    <div class="detail-section">
                                        <h4>Recommended Approach</h4>
                                        <div class="detail-item">
                                            <strong>${company.intelligence.recommendation}</strong>
                                        </div>
                                        <div class="detail-item" style="margin-top: 10px;">
                                            <span class="detail-label">Priority Score:</span>
                                            <span class="detail-value">${company.score}/100</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    `;
                    
                    tbody.appendChild(detailsRow);
                }
            });
            
            // Update stats
            document.getElementById('tier1Count').textContent = tier1Count;
            document.getElementById('withIntel').textContent = withIntelCount;
            document.getElementById('noProgram').textContent = noProgramCount;
            document.getElementById('chubbClients').textContent = chubbClientCount;
            document.getElementById('totalUnits').textContent = (totalUnits / 1000).toFixed(0) + 'K';
        }
        
        // Initial render
        renderTable();
        
        // Event listeners
        document.getElementById('filterTier').addEventListener('change', renderTable);
        document.getElementById('filterProgram').addEventListener('change', renderTable);
        document.getElementById('filterChubb').addEventListener('change', renderTable);
        document.getElementById('searchCompany').addEventListener('input', renderTable);
        
        // Export to Excel
        function exportToExcel() {
            const exportData = companies.map((company, index) => {
                const row = {
                    'Rank': index + 1,
                    'Company': company.name,
                    'Units': company.units,
                    'Score': company.score,
                    'Tier': company.tier,
                    'Chubb Client': company.chubbStatus || 'No',
                    'Intelligence Level': company.hasIntel ? 'Full Intelligence' : 'Basic Data',
                    'Current Program': company.program || 'Unknown',
                    'Current Provider': company.provider || 'None'
                };
                
                if (company.hasIntel && company.intelligence) {
                    row['Status'] = company.intelligence.status;
                    row['Opportunities'] = company.intelligence.opportunities ? company.intelligence.opportunities.join('; ') : '';
                    row['Pain Points'] = company.intelligence.painPoints ? company.intelligence.painPoints.join('; ') : '';
                    row['Details'] = company.intelligence.details;
                    row['Recommendation'] = company.intelligence.recommendation;
                }
                
                return row;
            });
            
            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "PMC Intelligence Report");
            XLSX.writeFile(wb, "Mid_Market_PMC_Intelligence_Report.xlsx");
        }
    </script>
</body>
</html>
